# <a name="coauthoring-in-excel-add-ins"></a>Совместное редактирование в надстройках Excel  

Благодаря функции [совместного редактирования](https://support.office.com/en-US/article/Collaborate-on-Excel-workbooks-at-the-same-time-with-co-authoring-7152aa8b-b791-414c-a3bb-3024e46fb104), несколько человек могут работать вместе и редактировать одну и ту же книгу Excel одновременно. Все соавторы книги могут видеть изменения, внесенные и сохраненные другими соавторами. Книги Excel, доступные для совместного редактирования, должны храниться в OneDrive, OneDrive для бизнеса или SharePoint Online.

> **Важно!** В Excel 2016 для Office 365 в левом верхнем углу можно заметить надпись "Автосохранение". Если автосохранение включено, соавторы видят внесенные вами изменения в режиме реального времени. Учтите влияние такого поведения на макет вашей надстройки Excel. Пользователи могут выключить автосохранение с помощью переключателя в левом верхнем углу окна Excel.

Совместное редактирование доступно на следующих платформах:

- Excel Online
- Excel для Android
- Excel для iOS
- Excel Mobile для Windows 10
- Excel для компьютера с Windows для пользователей Office 365 (компьютер с версией Windows сборки 16.0.8326.2076 или выше, доступной для пользователей Current Branch с августа 2017 г.)

## <a name="coauthoring-overview"></a>Общие сведения о совместном редактировании
 
При изменении содержимого книги Excel автоматически синхронизирует эти изменения для всех соавторов. Вносить изменения в содержимое книги могут не только соавторы, но и код, выполненный в надстройке Excel. Например, когда следующий код JavaScript выполняется в надстройке Office, для диапазона задается значение "Contoso":


    range.values = [[‘Contoso’]];

После того, как книга со значением"Contoso" синхронизируется со всеми соавторами, любой пользователь или надстройка, выполняемая в той же книге, будет видеть/учитывать новое значение диапазона. 

Функция совместного редактирования синхронизирует содержимое только для общей книги. Значения, скопированные из книги в переменные JavaScript в надстройке Excel, не синхронизируются. Например, если надстройка хранит значение ячейки (к примеру, "Contoso") в переменной JavaScript, а соавтор изменяет значение ячейки на "Пример", после синхронизации все соавторы увидят в ячейке значение "Пример". Однако, для ячейки в переменной JavaScript по-прежнему будет задано значение "Contoso". Кроме того, когда несколько соавторов используют одну и ту же надстройку, у каждого соавтора есть своя, не синхронизированная с остальными, копия переменной. Перед работой с переменными, использующими содержимое книги, убедитесь, что все значения в книге обновлены. 

## <a name="use-events-to-manage-the-in-memory-state-of-your-add-in"></a>Использование событий для управления состоянием надстройки в памяти
 
Надстройки Excel могут читать содержимое книги (из скрытых листов и объекта параметра), а затем хранить его в таких структурах данных как переменные. После того как исходные значения скопированы в любую из структур данных, соавторы могут обновить исходное содержание книги. Это означает, что теперь скопированные значения в структурах данных не синхронизируются с содержимым книги. При создании надстроек необходимо учитывать это разделение содержания книги и значений, хранящихся в структурах данных.

Например, вы можете создать надстройку контента, которая отображает пользовательские визуализации. Состояние ваших пользовательских визуализаций может быть сохранено в скрытом листе. Когда соавторы используют одну и ту же книгу, может возникнуть следующая ситуация:

- Пользователь A открывает документ, и пользовательские визуализации отображаются в книге. Пользовательские визуализации читают данные из скрытого листа (например, задан синий цвет визуализации).
- Пользователь Б открывает тот же документ, начинает изменять пользовательские визуализации и в качестве цвета для них задает оранжевый. Оранжевый цвет сохраняется в скрытом листе.
- Скрытый лист пользователя А обновляется с новым значением "оранжевый цвет".
- Пользовательские визуализации пользователя А по-прежнему синие. 

Если вы хотите, чтобы пользовательские визуализации пользователя А соответствовали изменениям, внесенным соавторами в скрытом листе, используйте событие [BindingDataChanged](http://dev.office.com/reference/add-ins/shared/binding.bindingdatachangedevent). Это обеспечит отражение изменений, внесенных соавторами в содержимое книги, в вашей надстройке.

## <a name="caveats-to-using-events-with-co-authoring"></a>Предостережения, касающиеся использования событий при совместном редактировании 

Как описано выше, в некоторых сценариях события-триггеры для всех соавторов обеспечивают улучшенное взаимодействие с пользователем. Однако, имейте ввиду, что в ряде сценариев такое поведение может привести к неудобствам в работе пользователей. 

Например, обычно в сценариях проверки данных пользовательский интерфейс отображается в ответ на события. Событие [BindingDataChanged](http://dev.office.com/reference/add-ins/shared/binding.bindingdatachangedevent), описанное в предыдущем разделе, выполняется когда локальный пользователь или соавтор (удаленный) изменяет содержимое книги в пределах привязки. Если обработчик событий отображает пользовательский интерфейс в ответ на событие **BindingDataChanged**, пользователи увидят пользовательский интерфейс, не связанный с изменениями, над которыми они работали в книге, что приведет к определенным неудобствам. Избегайте отображения пользовательского интерфейса при использовании событий в вашей надстройке.

## <a name="see-also"></a>См. также 

- [О совместном редактировании в Excel (VBA)](https://msdn.microsoft.com/en-us/vba/excel-vba/articles/about-coauthoring-in-excel) 
- [Как автосохранение влияет на надстройки и макросы (VBA)](https://msdn.microsoft.com/en-us/vba/office-shared-vba/articles/how-autosave-impacts-addins-and-macros) 
