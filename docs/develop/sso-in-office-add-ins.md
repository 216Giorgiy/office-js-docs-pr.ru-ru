---
title: ????????? ??????? ????? ??? ????????? Office
description: ''
ms.date: 04/10/2018
ms.openlocfilehash: 45bd63150ffa8e46bf9c0fa54711ac907b8490ce
ms.sourcegitcommit: c72c35e8389c47a795afbac1b2bcf98c8e216d82
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/23/2018
---
# <a name="enable-single-sign-on-for-office-add-ins-preview"></a>????????? ??????? ????? ??? ????????? Office (???????? ?????)

???????????? ?????? ? Office (? ?????????, ?? ????????? ??????????? ? ?????????? ???????????), ????????? ?????? ??????? ?????? ?????????? ???? ??????? ??? ??????? ??????? ?????? (Office 365). ?????????????? ??????? ???????? ??????? ????? ??? ??????????? ??????????? ???????????? ? ????? ?????????? ??? ????????????? ?????????? ?????.


![???????????, ?????????????? ??????? ????? ? ??????????](../images/office-host-title-bar-sign-in.png)

> [!NOTE]
> ? ????????? ????? API ??????? ????? ?????????????? ??? Word, Excel, Outlook ? PowerPoint ? ???????? ??????. ?????????????? ???????? ? ??????? ????????? API ??????? ????? ??. ? ?????? [?????? ???????????? ????????? API ?????????????](https://dev.office.com/reference/add-ins/requirement-sets/identity-api-requirement-sets).
> ???? ?? ????????? ? ??????????? Outlook, ??????????? ???????? ??????????? ???????? ??????????? ??? ??????? Office 365. ?????????? ??. ? [???? ??????](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).

????????????? ????? ??????? ????????? ??????????, ??? ??? ?? ???????? ?????? ??? ????????? ????. ??? ????????????? ??? ????????, ??? ? ?????????? ?? ????? ????????? ??????? ????????????? ? ?????????????? ????????.

### <a name="how-it-works-at-runtime"></a>??????? ?????? ?? ????? ??????????

?? ??????????? ???? ????? ????????, ??? ???????? ?????? ????.

![????? ??????? ?????](../images/sso-overview-diagram.png)

1. ??? JavaScript ?????????? ???????? ????? API Office.js ? `getAccessTokenAsync`. ?? ????????? ???????? ?????????? Office, ??? ?????????? ???????? ?????? ??????? ? ??????????. ??. ?????? [?????? ??????? ???????](#example-access-token).
2. ???? ???? ? Office ?? ????????, ? ??????? ?????????? ??????????? ??????????? ????, ? ??????? ???????????? ???????????? ?????.
3. ???? ???????????? ????????? ?????????? ? ?????? ???, ??? ???????????? ???? ????????.
4. ??????? ?????????? Office ??????????? **?????? ??????????** ? ???????? ????? Azure AD ?????? 2.0 ??? ???????? ????????????.
5. Azure AD ?????????? ?????? ?????????? ???????? ?????????? Office.
6. ??????? ?????????? Office ?????????? **??????** ?????????? ? ??????? ??????? ??????????, ????????????? ??? ?????? ?????? `getAccessTokenAsync`.
7. JavaScript ? ?????????? ????? ???????????????? ?????? ? ??????? ??????????? ??????????, ????????, ????? ??????????? ????? ????????????. 
8. ????? ????, ?????????? ????? ????????? HTTP-?????? ?? ?????? ??? ????????? ?????????????? ???????? ? ????????????, ????????, ???????????? ????????????. ????? ????? ????????? ?????? ??????? ?? ?????? ??? ??????? ? ????????. 

## <a name="develop-an-sso-add-in"></a>?????????? ?????????? ? ?????? ??????

? ???? ??????? ??????? ??????, ??????????? ??? ???????? ?????????? Office ? ?????? ??????. ??? ?????? ??????????? ?????????? ?? ????? ? ?????????. ????????? ????????? ?????????? ??. ? ????????? ???????:

* [???????? ?????????? Office ?? ????????? Node.js ? ?????????????? ??????? ?????](create-sso-office-add-ins-nodejs.md)
* [???????? ?????????? Office ?? ????????? ASP.NET ? ?????????????? ??????? ?????](create-sso-office-add-ins-aspnet.md)

### <a name="create-the-service-application"></a>???????? ??????????-??????

??????????????? ?????????? ?? ??????? ??????????? ??? ???????? ????? Azure ?????? 2.0: https://apps.dev.microsoft.com. ???? ??????? ???????? 5?10 ????? ? ???????? ????????? ??????.

* ????????? ?????????????? ? ??????? ??????? ??? ??????????.
* ??????? ??????????? ??? ?????????? ?????????? ??? ???????? ????? AAD ?????? 2.0 (? ????????????? ??? Microsoft Graph). ?????????? "???????" ????????? ??????.
* ?????????????? ?????????? ??????? ???????? ?????????? Office.
* ??????????????? ??????????? ???????? ?????????? Office ??? ?????????? ? ??????? ????????? ?? ????????? ?????????? *access_as_user*.

??? ????????? ?????????????? ?????????? ?? ???? ???????? ??. ?????? [??????????? ?????????? Office, ???????????? ?????? ???? ? ???????? ?????? Azure AD ?????? 2.0](register-sso-add-in-aad-v2.md).

### <a name="configure-the-add-in"></a>???????????? ??????????

???????? ????? ???????? ? ???????? ??????????:

* **WebApplicationInfo** ? ???????????? ??????? ??? ????????? ???? ?????????.
* **Id** ? ????????????? ??????? ??????????. ??? ????????????? ??????????, ??????? ?? ????????? ? ?????? ??????????? ??????????. ??. ?????? [??????????? ?????????? Office, ???????????? ?????? ???? ? ???????? ?????? Azure AD ?????? 2.0](register-sso-add-in-aad-v2.md).
* **Resource** ? URL-????? ??????????.
* **Scopes** ? ???????????? ??????? ?????? ??? ?????????? ????????? **Scope**.
* **Scope** ? ????????? ??????????, ??????????? ?????????? ??? ?????? ? AAD. ?????????? `profile` ????????? ??????, ??? ????? ???? ???????????? ??????????? ???????????, ???? ?????????? ?? ???????? ?????? ? Microsoft Graph. ???? ?????????? ???????? ???? ??????, ??????????? ???????? **Scope** ??? ??????????? ?????????? Microsoft Graph; ????????, `User.Read`, `Mail.Read`. ??? ?????????, ??????? ???????????? ? ???? ??? ??????? ? Microsoft Graph, ????? ????????????? ?????????????? ??????????. ????????, ??? ?????????? ???????? ??????????? ?????????? (MSAL) ??? .NET ????????? ?????????? `offline_access`. ??? ????????? ?????????????? ?????????? ??. ?????? [?????????????? ?????? ? Microsoft Graph ?? ????? ?????????? Office](authorize-to-microsoft-graph.md).

??? ???? ??????? ??????????, ????? Outlook, ???????? ???????? ? ????? ??????? `<VersionOverrides ... xsi:type="VersionOverridesV1_0">`. ??? Outlook ???????? ???????? ? ????? ??????? `<VersionOverrides ... xsi:type="VersionOverridesV1_1">`.

???? ???????? ?????? ????? ????.

```xml
<WebApplicationInfo>
    <Id>5661fed9-f33d-4e95-b6cf-624a34a2f51d</Id>
    <Resource>api://addin.contoso.com/5661fed9-f33d-4e95-b6cf-624a34a2f51d</Resource>
    <Scopes>
        <Scope>user.read</Scope>
        <Scope>files.read</Scope>
        <Scope>profile</Scope>
    </Scopes>
</WebApplicationInfo>
```

### <a name="add-client-side-code"></a>?????????? ???? ??? ???????

???????? ? ?????????? ??? JavaScript ???:

* ???????? [Office.context.auth.getAccessTokenAsync](https://dev.office.com/reference/add-ins/shared/office.context.auth.getAccessTokenAsync).
* ??????????????? ?????? ??????? ??? ????????? ??? ? ????????? ??? ??????????. 

????? ??????????? ??????? ?????? ?????? `getAccessTokenAsync`. 

> [!Note]
> ? ?????? ??????? ??????????? ?????? ???? ??? ??????. ??????? ????? ??????? ????????? ??????: [Home.js ? Office-Add-in-ASPNET-SSO](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/Complete/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/Home.js) ? [program.js ? Office-Add-in-NodeJS-SSO](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/public/program.js). ??. ?????? [?????????? ?????? ??????? ?????](troubleshoot-sso-in-office-add-ins.md).
 

```js
Office.context.auth.getAccessTokenAsync(function (result) {
    if (result.status === "succeeded") {
        // Use this token to call Web API
        var ssoToken = result.value;
        ...
    } else {
        if (result.error.code === 13003) {
            // SSO is not supported for domain user accounts, only
            // work or school (Office 365) or Microsoft Account IDs.
        } else {
            // Handle error
        }
    }
});
```

????? ??????????? ?????? ???????? ??????? ?????????? ?? ??????. ??? ???????? ??????? ??????? ?? ?????? ?????? ??????????? ? ???????? ????????? `Authorization`. ?????? ?????? ??????????????? ???????? ?????? JSON, ??????? ???????????? ????? `POST`, ?????? `GET` ?????????? ??? ???????? ??????? ???????, ???? ?? ??????????? ?????? ? ??????.

```js
$.ajax({
    type: "POST",
    url: "/api/DoSomething",
    headers: {
        "Authorization": "Bearer " + ssoToken
    },
    data: { /* some JSON payload */ },
    contentType: "application/json; charset=utf-8"
}).done(function (data) {
    // Handle success
}).fail(function (error) {
    // Handle error
}).always(function () {
    // Cleanup
});
```

#### <a name="when-to-call-the-method"></a>????? ???????? ?????

???? ?????????? ?? ????? ???????? ??? ????? ? Office, ?????????? ??????? `getAccessTokenAsync` *??? ??????? ??????????*.

???? ?????????? ????? ???????? ??? ?????, ????? `getAccessTokenAsync` *??????????, ????? ????????? ????*. ?????????????????? ?? ????????? ??? ????????????? ??????? `getAccessTokenAsync`, ??? ??? Office ???????? ?????? ??????? ? ?????????? ???, ???? ?? ??????? ???? ??? ????????, ?? ??????? ???????? ????? AAD ?????? 2.0 ??? ?????? ?????? `getAccessTokenAsync`. ??????? ?????? `getAccessTokenAsync` ????? ????????? ?? ??? ??????? ? ???????????, ??????? ?????????? ????????, ??? ????? ??????.

### <a name="add-server-side-code"></a>?????????? ?????????? ????

? ??????????? ??????? ??????????? ??? ?????? ???????? ?????? ???????, ???? ?????????? ?? ???????? ??? ?? ??????? ??????? ? ?? ?????????? ??? ???. ????? ??????? ????????? ????????? ??????, ??????? ????? ????????? ??????????.

* ???????? ???? ??? ????????? ??????? ???-API, ???????????? ?????????? ? ????????????, ??????? ??????????? ?? ???????; ????????, ????? ?????? ???????????? ???????????? ? ???? ?????? ?? ???????. (??. ?????? **????????????? ??????? ??????? ????? ? ???????? ?????????????** ?????.) ? ??????????? ?? ????? ? ????????? ????? ???? ???????? ??????????, ??????? ???????? ???????? ??????? ????.
* ???????? ?????? Microsoft Graph. ????????? ??? ??????:

    * ???????? ??????? ??????? (??. ?????? **???????? ??????? ???????** ?????).
    * ????????? ????? "?? ?????" ????? ?????? ???????? ????? Azure AD ?????? 2.0, ??????????? ?????? ???????, ????????? ?????????? ???????????? ? ??????? ?????? ?????????? (????????????? ? ??????). ? ???? ????????? ?????? ??????? ?????????? ???????? ????????? ????????.
    * ????????? ??????????? ?????? ??????? ??????? ?? ?????? "?? ?????".
    * ???????? ?????? ?? Microsoft Graph ? ??????? ?????? ???????.

 ??? ????????? ?????????????? ?????????? ? ????????? ?????????????????? ??????? ? ?????? ???????????? Microsoft Graph ??. ?????? [?????????????? ?????? ? Microsoft Graph ?? ????? ?????????? Office](authorize-to-microsoft-graph.md).

#### <a name="validate-the-access-token"></a>???????? ??????? ???????

????? ???-API ??????? ?????? ???????, ???? ????? ?????????? ????????? ????? ??????????????. ??? ?????? JSON Web Token (JWT), ?? ???? ??? ???????? ??????????? ??? ??, ??? ? ? ??????????? ??????????? ??????? OAuth. ???????? ????????? ?????????, ??????? ????? ????????? ???????? JWT, ???????? ?? ????????:

- ????????? ???????????? ??????? ???????;
- ?????????, ????? ?? ?????? ?????? ??????? ????????????;
- ?????????, ???????????? ?? ?????? ??? ???-API.

??? ???????? ??????? ?????????? ??????????? ???? ????????????.

- ?????????????? ??????? ??????? ????? ?????? ????? ???????????? Azure, `https://login.microsoftonline.com`. ??????????? `iss` ? ??????? ?????? ?????????? ? ????? ????????.
- ????????? `aud` ??????? ????? ????????? ???????? ?????????????? ?????????? ? ??????? ???????????.
- ??? ????????? `scp` ??????? ????? ?????? ???????? `access_as_user`.

#### <a name="using-the-sso-token-as-an-identity"></a>????????????? ??????? ??????? ????? ? ???????? ?????????????

???? ?????????? ?????????? ????????? ????????????? ????????????, ?? ?????? ??????? ????? ???????? ????????, ? ??????? ??????? ????? ?????????? ???. ???? ??????????? ??????????? ?? ???????, ????????? ? ???????????????.

- `name` ? ???????????? ??? ????????????.
- `preferred_username` ? ????? ??????????? ????? ????????????.
- `oid` ? GUID, ??????????????? ?? ???????????? ? Azure Active Directory.
- `tid` ? GUID, ??????????????? ?? ??????????? ???????????? ? Azure Active Directory.

???????? `name` ? `preferred_username` ????? ????????, ??????? ????????????? ???????????? ???????? `oid` ? `tid`, ????? ??????? ????????????? ? ?????????? ??????? ???????????.

????????, ???? ?????? ????? ????????????? ??? ???????? ?????? (? ???? `{oid-value}@{tid-value}`), ?? ?? ??????? ??????? ? ???????? ???????? ? ?????? ???????????? ?? ?????????? ???? ?????? ?????????????. ??? ??????????? ???????? ????????????? ???????????? ????? ????? ???????? ? ??????? ???? ?? ????????, ? ?????? ? ???????????? ???????? ????? ??????????????? ? ???????????? ? ???????????? ??????????? ?????????? ????????.

### <a name="example-access-token"></a>?????? ??????? ???????

????? ???????????? ???????? ?????????????? ???????? ?????? ??????? ???????. ??? ????????? ?????????????? ?????????? ? ????????? ??. ?????? [?????? ?? ??????? Azure Active Directory v2.0](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-tokens).


```js
{
    aud: "2c3caa80-93f9-425e-8b85-0745f50c0d24",         
    iss: "https://login.microsoftonline.com/fec4f964-8bc9-4fac-b972-1c1da35adbcd/v2.0",         
    iat: 1521143967,         
    nbf: 1521143967,         
    exp: 1521147867,         
    aio: "ATQAy/8GAAAA0agfnU4DTJUlEqGLisMtBk5q6z+6DB+sgiRjB/Ni73q83y0B86yBHU/WFJnlMQJ8",         
    azp: "e4590ed6-62b3-5102-beff-bad2292ab01c",         
    azpacr: "0",         
    e_exp: 262800,         
    name: "Mila Nikolova",         
    oid: "6467882c-fdfd-4354-a1ed-4e13f064be25",         
    preferred_username: "milan@contoso.com",         
    scp: "access_as_user",         
    sub: "XkjgWjdmaZ-_xDmhgN1BMP2vL2YOfeVxfPT_o8GRWaw",         
    tid: "fec4f964-8bc9-4fac-b972-1c1da35adbcd",         
    uti: "MICAQyhrH02ov54bCtIDAA",         
    ver: "2.0"
}
```

## <a name="using-sso-with-and-outlook-add-in"></a>????????????? ??????? ????? ? ?????????? Outlook

??????? ?????????, ?? ?????? ???????? ????? ?????????????? ??????? ??????? ????? ? ?????????? Outlook ? ?????????????? ?? ? ?????????? Excel, PowerPoint ??? Word. ???????????? ?? ???????? [?????????????? ???????????? ? ???????? ??????? ????? ? ?????????? Outlook](https://docs.microsoft.com/en-us/outlook/add-ins/authenticate-a-user-with-an-sso-token) ? [????????: ?????????? ??????? ????? ??? ?????? ? ?????????? Outlook](https://docs.microsoft.com/en-us/outlook/add-ins/implement-sso-in-outlook-add-in).